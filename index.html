<!DOCTYPE html>
<html>
<head>
  <title>ESP Relay Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; }
    button { padding: 12px 24px; margin: 10px; font-size: 18px; }
    input { padding: 10px; width: 120px; font-size: 18px; text-align: center; }
    .block { margin-top: 30px; padding: 15px; border: 2px solid #444; border-radius: 10px; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

  <h2>ESP Cloud Relay Control</h2>

  <!-- Relay 1 Section -->
  <div class="block">
    <h3>Relay 1 Status: <span id="s1">Deactivated</span></h3>

    <input id="t1" type="number" placeholder="Seconds" min="1"><br><br>

    <button onclick="activateRelay('Relay1', 't1')">Activate Relay 1</button>
  </div>

  <!-- Relay 2 Section -->
  <div class="block">
    <h3>Relay 2 Status: <span id="s2">Deactivated</span></h3>

    <input id="t2" type="number" placeholder="Seconds" min="1"><br><br>

    <button onclick="activateRelay('Relay2', 't2')">Activate Relay 2</button>
  </div>


<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyXXXX...",
    authDomain: "esp01-99f44.firebaseapp.com",
    databaseURL: "https://esp01-99f44-default-rtdb.firebaseio.com",
    projectId: "esp01-99f44",
    storageBucket: "esp01-99f44.appspot.com",
    messagingSenderId: "XXXX",
    appId: "1:XXXX:web:XXXX"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ============================
  // ACTIVATE RELAY WITH TIMER
  // ============================
  function activateRelay(relay, textboxID) {
    let sec = document.getElementById(textboxID).value;

    if (sec <= 0 || sec === "") {
      alert("Enter valid seconds!");
      return;
    }

    // Set relay ON and store timer
    db.ref(relay).set({
      state: "ON",
      timer: Number(sec)
    });
  }

  // ============================
  // LIVE STATUS UPDATE
  // ============================
  function updateStatus() {
    db.ref("Relay1/state").on("value", snap => {
      document.getElementById("s1").innerText =
        snap.val() === "ON" ? "Start" : "Stop";
    });

    db.ref("Relay2/state").on("value", snap => {
      document.getElementById("s2").innerText =
        snap.val() === "ON" ? "Start" : "Stop";
    });
  }

  updateStatus();
</script>

</body>
</html>
